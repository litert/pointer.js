!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pointer={})}(this,function(t){"use strict";function e(t){return new Promise(e=>setTimeout(e,t))}function o(t){return"touch"===t.pointerType}function n(t){return{x:t.clientX,y:t.clientY}}function i(t,e){return Math.abs(e)>Math.abs(t)?e<0?"top":"bottom":t<0?"left":"right"}const r=/disabled/i;let s=null;function a(t){s||(s=document.createElement("style"),s.id="pointer-global-cursor",document.head.appendChild(s)),s.innerHTML=t?`*, *::after, *::before {cursor: ${t} !important;}`:""}function d(t,e){const o=t.target;let r,{x:s,y:a}=n(t),d=!1;const c=function(t){t.target&&document.body.contains(t.target)||!t.cancelable||t.preventDefault();const{x:o,y:p}=n(t);if(o===s&&p===a)return;const l=i(o-s,p-a);if(s=o,a=p,!d&&(d=!0,!1===e.start?.(t)))return window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),void window.removeEventListener("pointercancel",r);!1===e.move?.(t,l)&&(window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r))};r=function(t){window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r),e.up?.(t),d&&e.end?.(t)},o?.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",c,{passive:!1}),window.addEventListener("pointerup",r),window.addEventListener("pointercancel",r),e.down?.(t)}t.isMoving=!1;const c={down:[],up:[]};function p(t,e,o,n,i,r,s,a){let d=!1,c=!1;if(o<=i)d=!0,o<i&&t<e&&(t=e-s>i?i+s:e);else if(0!==a)n>=r&&(c=!0,n>r&&t>e&&(t=e+a<r?r-a:e));else{const o=r-1;t>=o&&(c=!0,t>o&&t>e&&(t=e<o?o:e))}return{val:t,atMin:d,atMax:c}}function l(e,o){t.isMoving=!0,a(o.cursor??getComputedStyle(e.target).cursor);let i,r,s,l,{x:f,y:u}=n(e);if(o.areaObject){const t=o.areaObject.getBoundingClientRect(),e=getComputedStyle(o.areaObject);i=t.left+parseFloat(e.borderLeftWidth)+parseFloat(e.paddingLeft),r=t.top+parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop),s=t.left+t.width-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight),l=t.top+t.height-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight)}else i=o.left??0,r=o.top??0,s=o.right??window.innerWidth,l=o.bottom??window.innerHeight;i+=o.offsetLeft??0,r+=o.offsetTop??0,s+=o.offsetRight??0,l+=o.offsetBottom??0;let v=!1,m=0,b=0,g=0,h=0,w=0,y=0,x=0,L=0;const j=[];for(const t of c.down)t(e,o);return d(e,{start:()=>{if(!1===o.start?.(f,u))return a(),!1;if(o.object){const t=o.object.getBoundingClientRect();m=t.left,b=t.top,g=t.width,h=t.height}else m=o.objectLeft??0,b=o.objectTop??0,g=o.objectWidth??0,h=o.objectHeight??0;g>0&&(w=f-m),h>0&&(y=u-b),x=g-w,L=h-y},move:(t,e)=>{let{x:a,y:d}=n(t);if(a===f&&d===u)return;const c=p(a,f,a-w,a+x,i,s,w,x),m=p(d,u,d-y,d+L,r,l,y,L);a=c.val,d=m.val;const b=c.atMin,g=c.atMax,h=m.atMin,E=m.atMax,T=h||g||E||b,M=T?function(t,e,o,n,i,r,s,a,d,c){return t&&n?"lt":t&&e?"tr":o&&e?"rb":o&&n?"bl":t?i-s<=20?"lt":d-i<=20?"tr":"t":e?r-a<=20?"tr":c-r<=20?"rb":"r":o?d-i<=20?"rb":i-s<=20?"bl":"b":n?r-a<=20?"lt":c-r<=20?"bl":"l":""}(h,g,E,b,a,d,i,r,s,l):"";T?v||(v=!0,o.borderIn?.(a,d,M,t)):v&&(v=!1,o.borderOut?.());const D=a-f,P=d-u;j.push({time:Date.now(),ox:D,oy:P}),o.move?.(t,{ox:D,oy:P,x:a,y:d,border:M,inBorder:{top:h,right:g,bottom:E,left:b},dir:e}),f=a,u=d},up:n=>{t.isMoving=!1,a();for(const t of c.up)t(e,o);o.up?.(j,n)},end:t=>{o.end?.(j,t)}}),{left:i,top:r,right:s,bottom:l}}function f(t,e){if(t.button>0)return;const o=t.clientX,n=t.clientY,i=Date.now();d(t,{up:t=>{if(Date.now()-i>=250)return;const r=t.clientX,s=t.clientY;r===o&&s===n&&e(t,r,s)}})}const u={time:0,x:0,y:0};let v,m=0;function b(t,e,o){const{x:i,y:r}=n(t);let s=0,a=0,c=!1,p=window.setTimeout(()=>{p=void 0,s<=1&&a<=1&&(c=!0,Promise.resolve(e(t)).catch(t=>{throw t}))},o?.time??300);d(t,{down:o?.down,move:t=>{const{x:e,y:o}=n(t);s=Math.abs(e-i),a=Math.abs(o-r)},up:()=>{o?.up?.(t),void 0!==p?(clearTimeout(p),p=void 0):c&&(m=Date.now())}})}function g(t,e){t?.dispatchEvent(new CustomEvent(e,{detail:{value:v}}))}const h={last:0,offset:0,done:!1,timer:0,firstTimer:!1,dir:""},w={top:"bottom",bottom:"top",left:"right",right:"left"};let y=null;function x(){return y||(y=document.createElement("div"),y.className="pointer-gesture",document.body.appendChild(y),y.insertAdjacentHTML("afterend","<style>.pointer-gesture{position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,.7);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));}.pointer-gesture-done::before{content:'';background:rgba(255,255,255,.9);border-radius:50%;width:10px;height:10px;}.pointer-gesture-ani{transition: all .3s cubic-bezier(.39,.575,.565,1);transition-property:left,top,transform;}</style>")),y}function L(t,e,o,n=!1){const i=x(),r=o/90;i.style.transform=`scale(${r})`;"top"===e||"bottom"===e?(i.style.left=`${t.left+(t.width-20)/2}px`,i.style.top=n?`${"top"===e?t.top+10:t.bottom-10}px`:`${"top"===e?t.top+o/1.5:t.bottom-20-o/1.5}px`):(i.style.top=`${t.top+(t.height-20)/2}px`,i.style.left=n?`${"left"===e?t.left+10:t.right-10}px`:`${"left"===e?t.left+o/1.5:t.right-20-o/1.5}px`)}t.addMoveHook=function(t,e){c[t].push(e)},t.allowEvent=function(t){return!(Date.now()-m<5)&&!function(t){for(;t;){if(r.test(t.className))return!0;for(const e in t.dataset)if(r.test(e))return!0;t=t.parentElement}return!1}(t.currentTarget)},t.click=f,t.dblClick=function(t,e){f(t,(t,o,n)=>{const i=Date.now();if(i-u.time<=300){const i=Math.abs(o-u.x),r=Math.abs(n-u.y);if(i<10&&r<10)return e(t,o,n),u.time=0,u.x=0,void(u.y=0)}u.time=i,u.x=o,u.y=n})},t.down=d,t.drag=function(t,e,o){v=o?.data;let n=0,i=0,r=null,s=null;l(t,{object:e,start:(t,r)=>{const a=e.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${a.left}px;top:${a.top}px;width:${a.width}px;height:${a.height}px;background:rgba(255,255,255,.8);border:1px dashed rgba(0,0,0,.8);filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));pointer-events:none;z-index:999999;`,s.style.borderRadius=getComputedStyle(e).borderRadius,document.body.appendChild(s),n=a.top,i=a.left,o?.start?.(t,r)},move:(t,a)=>{n+=a.oy,i+=a.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const d=document.elementsFromPoint(a.x,a.y);for(const t of d)if(void 0!==t.dataset.drop&&t!==e){if(t===r)return;return r&&(r.removeAttribute("data-hover"),g(r,"dragleave")),t.dataset.hover="",r=t,void g(r,"dragenter")}r&&(r.removeAttribute("data-hover"),g(r,"dragleave"),r=null),o?.move?.(t,a)},end:(t,e)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),g(r,"drop")),o?.end?.(t,e),v=void 0}})},t.gesture=function(t,o,r){const s=t.currentTarget;if(!s)return;const a=s.getBoundingClientRect(),c=x();if(t instanceof PointerEvent){let e=0,i=0,s=1,p="top";d(t,{move:(r,d)=>{if(s<0){if(s>-30){const t=o(r,p);1===t?(r.stopPropagation(),r.preventDefault()):-1===t&&r.stopPropagation(),--s}return}if(1===s){s=0,p=w[d];const e=o(r,p);if(1!==e)return-1===e&&r.stopPropagation(),void(s=-1);r.stopPropagation(),r.preventDefault();const{x:a,y:c}=n(t);i="top"===p||"bottom"===p?c:a}const{x:l,y:f}=n(r),u="top"===p||"bottom"===p?f:l;e="top"===p||"left"===p?u-i:i-u,e=Math.max(0,Math.min(90,e)),c.style.opacity=e>0?"1":"0",c.classList.toggle("pointer-gesture-done",e>=90),L(a,p,e)},end:()=>{c.style.opacity="0",e>=90&&r?.(p)}})}else(async()=>{const n=Date.now();if(n-h.last>250&&(h.offset=0,h.done=!1,h.timer=0,h.firstTimer=!1,h.dir=""),h.last=n,h.firstTimer||h.done)return;let s=t.deltaY,d=t.deltaX;if(""===h.dir){h.dir=i(d,s);const n=o(t,h.dir);if(1!==n)return void(-1===n?(t.stopPropagation(),h.done=!0):h.dir="");t.stopPropagation(),t.preventDefault(),L(a,h.dir,0,!0),h.firstTimer=!0,await e(30),h.firstTimer=!1,c.classList.add("pointer-gesture-ani")}const p="top"===h.dir||"bottom"===h.dir?s:d;if(h.offset+="top"===h.dir||"left"===h.dir?-p:p,h.offset<0)return h.offset=0,void(c.style.opacity="0");c.style.opacity="1";let l=Math.min(90,h.offset/1.38);c.classList.toggle("pointer-gesture-done",l>=90),L(a,h.dir,l),clearTimeout(h.timer),l<90?h.timer=window.setTimeout(()=>{c.style.opacity="0",c.classList.remove("pointer-gesture-ani")},250):(h.done=!0,r?.(h.dir),await e(500),c.style.opacity="0",c.classList.remove("pointer-gesture-ani"))})().catch(()=>{})},t.getDragData=function(){return v},t.getEventPos=n,t.getMoveDir=i,t.hover=function(t,e){const n=t.currentTarget;if(n)if(o(t)){if(n.dataset.pointerHover)return;n.dataset.pointerHover="1",e.enter?.(t);const o=function(t){e.move?.(t)},i=function(t){e.leave?.(t),delete n.dataset.pointerHover,n.removeEventListener("pointerleave",i),window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",i),window.removeEventListener("pointercancel",i)};n.addEventListener("pointerleave",i),window.addEventListener("pointermove",o),window.addEventListener("pointerup",i),window.addEventListener("pointercancel",i)}else{if("pointerdown"===t.type)return;e.enter?.(t);const o=function(t){e.move?.(t)},i=function(t){e.leave?.(t),window.removeEventListener("pointermove",o),n.removeEventListener("pointerleave",i)};window.addEventListener("pointermove",o),n.addEventListener("pointerleave",i)}},t.isTouch=o,t.long=b,t.menu=function(t,n){if(!t.currentTarget)return;if(o(t)){const o=t=>{t.preventDefault()};return window.addEventListener("contextmenu",o),void b(t,n,{up:async()=>{await e(34),window.removeEventListener("contextmenu",o)}})}if(2!==t.button)return;const i=t=>{t.preventDefault(),n(t)};d(t,{up:()=>{window.addEventListener("contextmenu",i)}}),window.addEventListener("contextmenu",i)},t.move=l,t.removeMoveHook=function(t,e){const o=c[t].indexOf(e);-1!==o&&c[t].splice(o,1)},t.resize=function(t,e){const o=e.minWidth??0,i=e.minHeight??0,{x:r,y:s}=n(t);let a,d,c,p,f,u,v,m;if(void 0===e.objectLeft||void 0===e.objectTop||void 0===e.objectWidth||void 0===e.objectHeight){if(!e.object)return;const t=e.object.getBoundingClientRect();e.objectLeft=t.left,e.objectTop=t.top,e.objectWidth=t.width,e.objectHeight=t.height}const b=e.border,g="tr"===b||"r"===b||"rb"===b,h="bl"===b||"l"===b||"lt"===b,w="rb"===b||"b"===b||"bl"===b,y="lt"===b||"t"===b||"tr"===b;g?(f=e.objectLeft+o,a=c=r-(e.objectLeft+e.objectWidth),e.maxWidth&&(v=e.objectLeft+e.maxWidth)):h&&(v=e.objectLeft+e.objectWidth-o,a=c=r-e.objectLeft,e.maxWidth&&(f=e.objectLeft+e.objectWidth-e.maxWidth)),w?(u=e.objectTop+i,d=p=s-(e.objectTop+e.objectHeight),e.maxHeight&&(m=e.objectTop+e.maxHeight)):y&&(m=e.objectTop+e.objectHeight-i,d=p=s-e.objectTop,e.maxHeight&&(u=e.objectTop+e.objectHeight-e.maxHeight)),l(t,{left:f,top:u,right:v,bottom:m,offsetLeft:a,offsetTop:d,offsetRight:c,offsetBottom:p,start:e.start,move:(t,o)=>{g?e.objectWidth+=o.ox:h&&(e.objectWidth-=o.ox,e.objectLeft+=o.ox),w?e.objectHeight+=o.oy:y&&(e.objectHeight-=o.oy,e.objectTop+=o.oy),e.move?.(e.objectLeft,e.objectTop,e.objectWidth,e.objectHeight,o.x,o.y,o.border)},end:e.end})},t.scale=function(t,e){if(t instanceof WheelEvent)return void function(t,e){if(!t.deltaY)return;t.preventDefault();const o=Math.abs(t.deltaY),n=o*(o>50?.0015:.003);e(t,t.deltaY<0?1+n:1-n,{x:0,y:0})}(t,e);const o=t.target;if(!o)return;const n={pointers:new Map,lastDis:0,lastPos:{x:0,y:0},lastSinglePos:{x:t.clientX,y:t.clientY}};let i;n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const r=t=>{if(n.pointers.has(t.pointerId))if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),n.pointers.size>=2){const o=Array.from(n.pointers.values()),i=Math.hypot(o[0].x-o[1].x,o[0].y-o[1].y),r={x:(o[0].x+o[1].x)/2,y:(o[0].y+o[1].y)/2},s=n.lastDis>0?i/n.lastDis:1,a=r.x-n.lastPos.x,d=r.y-n.lastPos.y;e(t,s,{x:a,y:d}),n.lastDis=i,n.lastPos=r}else{const o=t.clientX-n.lastSinglePos.x,i=t.clientY-n.lastSinglePos.y;0===o&&0===i||(e(t,1,{x:o,y:i}),n.lastSinglePos={x:t.clientX,y:t.clientY})}else if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},s=t=>{if(n.pointers.delete(t.pointerId),1===n.pointers.size){n.lastDis=0;const t=Array.from(n.pointers.values());n.lastSinglePos={x:t[0].x,y:t[0].y}}0===n.pointers.size&&(window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",s),window.removeEventListener("pointerdown",i))};i=t=>{if(o.setPointerCapture?.(t.pointerId),n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},o.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",r,{passive:!1}),window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s),window.addEventListener("pointerdown",i)},t.setCursor=a,t.setDragData=function(t){v=t}});
