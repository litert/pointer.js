!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pointer={})}(this,function(t){"use strict";let e=0;function o(t){if(t instanceof TouchEvent||"touchstart"===t.type)return!1;if("touch"===t.pointerType&&"contextmenu"===t.type)return!0;return Date.now()-e<6e4}function n(t,e="client"){if(t instanceof MouseEvent)return{x:t.clientX,y:t.clientY};const o="changed"===e?t.changedTouches[0]:t.touches[0];return{x:o.clientX,y:o.clientY}}function i(t,e){return Math.abs(e)>Math.abs(t)?e<0?"top":"bottom":t<0?"left":"right"}"undefined"!=typeof document&&document.addEventListener("touchstart",function(){e=Date.now()},{passive:!0});const r=/disabled/i;let s=null;function c(t){s||(s=document.createElement("style"),s.id="pointer-global-cursor",document.head.appendChild(s)),s.innerHTML=t?`*, *::after, *::before {cursor: ${t} !important;}`:""}function a(t,e){if(o(t))return;const r=t instanceof MouseEvent,s=t.target;let c,{x:a,y:d}=n(t),u=!1;const l=function(t){t.target&&document.body.contains(t.target)||!t.cancelable||t.preventDefault();const{x:o,y:f}=n(t);if(o===a&&f===d)return;const p=i(o-a,f-d);a=o,d=f,u||(u=!0,!1!==e.start?.(t))?!1===e.move?.(t,p)&&(r?(window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)):s&&(s.removeEventListener("touchmove",l),s.removeEventListener("touchend",c),s.removeEventListener("touchcancel",c))):r?(window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)):s&&(s.removeEventListener("touchmove",l),s.removeEventListener("touchend",c),s.removeEventListener("touchcancel",c))};c=function(t){r?(window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)):s&&(s.removeEventListener("touchmove",l),s.removeEventListener("touchend",c),s.removeEventListener("touchcancel",c)),e.up?.(t),u&&e.end?.(t)},r?(window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("mouseup",c)):(s.addEventListener("touchmove",l,{passive:!1}),s.addEventListener("touchend",c),s.addEventListener("touchcancel",c)),e.down?.(t)}function d(t,e,o,n,i,r,s,c){let a=!1,d=!1;if(o<=i)a=!0,o<i&&t<e&&(t=e-s>i?i+s:e);else if(0!==c)n>=r&&(d=!0,n>r&&t>e&&(t=e+c<r?r-c:e));else{const o=r-1;t>=o&&(d=!0,t>o&&t>e&&(t=e<o?o:e))}return{val:t,atMin:a,atMax:d}}function u(e,i){if(o(e))return{left:0,top:0,right:0,bottom:0};t.isMoving=!0,c(i.cursor??getComputedStyle(e.target).cursor);let r,s,u,l,{x:f,y:p}=n(e);if(i.areaObject){const t=i.areaObject.getBoundingClientRect(),e=getComputedStyle(i.areaObject);r=t.left+parseFloat(e.borderLeftWidth)+parseFloat(e.paddingLeft),s=t.top+parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop),u=t.left+t.width-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight),l=t.top+t.height-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight)}else r=i.left??0,s=i.top??0,u=i.right??window.innerWidth,l=i.bottom??window.innerHeight;r+=i.offsetLeft??0,s+=i.offsetTop??0,u+=i.offsetRight??0,l+=i.offsetBottom??0;let h=!1,m=0,v=0,b=0,g=0,y=0,x=0,j=0,w=0;const E=[];return e.preventDefault(),a(e,{start:()=>{if(!1===i.start?.(f,p))return c(),!1;if(i.object){const t=i.object.getBoundingClientRect();m=t.left,v=t.top,b=t.width,g=t.height}else m=i.objectLeft??0,v=i.objectTop??0,b=i.objectWidth??0,g=i.objectHeight??0;b>0&&(y=f-m),g>0&&(x=p-v),j=b-y,w=g-x},move:(t,e)=>{let{x:o,y:c}=n(t);if(o===f&&c===p)return;const a=d(o,f,o-y,o+j,r,u,y,j),m=d(c,p,c-x,c+w,s,l,x,w);o=a.val,c=m.val;const v=a.atMin,b=a.atMax,g=m.atMin,L=m.atMax,T=g||b||L||v,M=T?function(t,e,o,n,i,r,s,c,a,d){return t?i-s<=20?"lt":a-i<=20?"tr":"t":e?r-c<=20?"tr":d-r<=20?"rb":"r":o?a-i<=20?"rb":i-s<=20?"bl":"b":n?r-c<=20?"lt":d-r<=20?"bl":"l":""}(g,b,L,v,o,c,r,s,u,l):"";T?h||(h=!0,i.borderIn?.(o,c,M,t)):h&&(h=!1,i.borderOut?.());const W=o-f,D=c-p;E.push({time:Date.now(),ox:W,oy:D}),i.move?.(t,{ox:W,oy:D,x:o,y:c,border:M,inBorder:{top:g,right:b,bottom:L,left:v},dir:e}),f=o,p=c},up:e=>{t.isMoving=!1,c(),i.up?.(E,e)},end:t=>{i.end?.(E,t)}}),{left:r,top:s,right:u,bottom:l}}function l(t,e){if(o(t))return;if(t instanceof MouseEvent&&t.button>0)return;const n=t instanceof MouseEvent?t.clientX:t.touches[0].clientX,i=t instanceof MouseEvent?t.clientY:t.touches[0].clientY,r=Date.now();a(t,{up:t=>{if(Date.now()-r>=250)return;const o=t instanceof MouseEvent?t.clientX:t.changedTouches[0].clientX,s=t instanceof MouseEvent?t.clientY:t.changedTouches[0].clientY;o===n&&s===i&&e(t,o,s)}})}t.isMoving=!1;const f={time:0,x:0,y:0};let p,h=0;function m(t,e){t?.dispatchEvent(new CustomEvent(e,{detail:{value:p}}))}const v={last:0,offset:0,done:!1,timer:0,firstTimer:!1,dir:""},b={top:"bottom",bottom:"top",left:"right",right:"left"};let g=null;function y(){return g||(g=document.createElement("div"),g.className="pointer-gesture",g.style.cssText="position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.3);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;",document.body.appendChild(g)),g}function x(t,e,o,n=!1){const i=y(),r=o/90;i.style.transform=`scale(${r})`;"top"===e||"bottom"===e?(i.style.left=`${t.left+(t.width-20)/2}px`,i.style.top=n?`${"top"===e?t.top+10:t.bottom-10}px`:`${"top"===e?t.top+o/1.5:t.bottom-20-o/1.5}px`):(i.style.top=`${t.top+(t.height-20)/2}px`,i.style.left=n?`${"left"===e?t.left+10:t.right-10}px`:`${"left"===e?t.left+o/1.5:t.right-20-o/1.5}px`)}function j(t){return new Promise(e=>setTimeout(e,t))}t.allowEvent=function(t){return!(Date.now()-h<5)&&!function(t){for(;t;){if(r.test(t.className))return!0;for(const e in t.dataset)if(r.test(e))return!0;t=t.parentElement}return!1}(t.currentTarget)},t.click=l,t.dblClick=function(t,e){l(t,(t,o,n)=>{const i=Date.now();if(i-f.time<=300){const i=Math.abs(o-f.x),r=Math.abs(n-f.y);if(i<10&&r<10)return e(t,o,n),f.time=0,f.x=0,void(f.y=0)}f.time=i,f.x=o,f.y=n})},t.down=a,t.drag=function(t,e,o){p=o?.data;let n=0,i=0,r=null,s=null;u(t,{object:e,start:(t,r)=>{const c=e.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${c.left}px;top:${c.top}px;width:${c.width}px;height:${c.height}px;background:rgba(0,0,0,0.1);border:1px dashed #666;pointer-events:none;z-index:999999;`,document.body.appendChild(s),n=c.top,i=c.left,o?.start?.(t,r)},move:(t,c)=>{n+=c.oy,i+=c.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const a=document.elementsFromPoint(c.x,c.y);for(const t of a)if(void 0!==t.dataset.drop&&t!==e){if(t===r)return;return r&&(r.removeAttribute("data-hover"),m(r,"dragleave")),t.dataset.hover="",r=t,void m(r,"dragenter")}r&&(r.removeAttribute("data-hover"),m(r,"dragleave"),r=null),o?.move?.(t,c)},end:(t,e)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),m(r,"drop")),o?.end?.(t,e),p=void 0}})},t.gesture=function(t,e,o){const r=t.currentTarget;if(!r)return;const s=r.getBoundingClientRect(),c=y();if(!(t instanceof MouseEvent||t instanceof TouchEvent)||t instanceof WheelEvent)(async()=>{const n=Date.now();if(n-v.last>250&&(v.offset=0,v.done=!1,v.timer=0,v.firstTimer=!1,v.dir=""),v.last=n,v.firstTimer||v.done)return;let r=t.deltaY,a=t.deltaX;if(""===v.dir){v.dir=i(a,r);const o=e(t,v.dir);if(1!==o)return void(-1===o?(t.stopPropagation(),v.done=!0):v.dir="");t.stopPropagation(),t.preventDefault(),x(s,v.dir,0,!0),v.firstTimer=!0,await j(30),v.firstTimer=!1,c.classList.add("ani")}const d="top"===v.dir||"bottom"===v.dir?r:a;if(v.offset+="top"===v.dir||"left"===v.dir?-d:d,v.offset<0)return v.offset=0,void(c.style.opacity="0");c.style.opacity="1";let u=Math.min(90,v.offset/1.38);c.classList.toggle("done",u>=90),x(s,v.dir,u),clearTimeout(v.timer),u<90?v.timer=window.setTimeout(()=>{c.style.opacity="0",c.classList.remove("ani")},250):(v.done=!0,o?.(v.dir),await j(500),c.style.opacity="0",c.classList.remove("ani"))})().catch(()=>{});else{let i=0,r=0,d=1,u="top";a(t,{move:(o,a)=>{if(d<0){if(d>-30){const t=e(o,u);1===t?(o.stopPropagation(),o.preventDefault()):-1===t&&o.stopPropagation(),--d}return}if(1===d){d=0,u=b[a];const i=e(o,u);if(1!==i)return-1===i&&o.stopPropagation(),void(d=-1);o.stopPropagation(),o.preventDefault();const{x:s,y:c}=n(t);r="top"===u||"bottom"===u?c:s}const{x:l,y:f}=n(o),p="top"===u||"bottom"===u?f:l;i="top"===u||"left"===u?p-r:r-p,i=Math.max(0,Math.min(90,i)),c.style.opacity=i>0?"1":"0",c.classList.toggle("done",i>=90),x(s,u,i)},end:()=>{c.style.opacity="0",i>=90&&o?.(u)}})}},t.getDragData=function(){return p},t.getEventPos=n,t.getMoveDir=i,t.hasTouchButMouse=o,t.long=function(t,e){if(o(t))return;const{x:i,y:r}=n(t);let s=0,c=0,d=!1,u=window.setTimeout(()=>{u=void 0,s<=1&&c<=1&&(d=!0,Promise.resolve(e(t)).catch(t=>{throw t}))},300);a(t,{move:t=>{const{x:e,y:o}=n(t);s=Math.abs(e-i),c=Math.abs(o-r)},up:()=>{void 0!==u?(clearTimeout(u),u=void 0):d&&(h=Date.now())}})},t.move=u,t.resize=function(t,e){if(o(t))return;const i=e.minWidth??0,r=e.minHeight??0,{x:s,y:c}=n(t);let a,d,l,f,p,h,m,v;if(void 0===e.objectLeft||void 0===e.objectTop||void 0===e.objectWidth||void 0===e.objectHeight){if(!e.object)return;const t=e.object.getBoundingClientRect();e.objectLeft=t.left,e.objectTop=t.top,e.objectWidth=t.width,e.objectHeight=t.height}const b=e.border,g="tr"===b||"r"===b||"rb"===b,y="bl"===b||"l"===b||"lt"===b,x="rb"===b||"b"===b||"bl"===b,j="lt"===b||"t"===b||"tr"===b;g?(p=e.objectLeft+i,a=l=s-(e.objectLeft+e.objectWidth),e.maxWidth&&(m=e.objectLeft+e.maxWidth)):y&&(m=e.objectLeft+e.objectWidth-i,a=l=s-e.objectLeft,e.maxWidth&&(p=e.objectLeft+e.objectWidth-e.maxWidth)),x?(h=e.objectTop+r,d=f=c-(e.objectTop+e.objectHeight),e.maxHeight&&(v=e.objectTop+e.maxHeight)):j&&(v=e.objectTop+e.objectHeight-r,d=f=c-e.objectTop,e.maxHeight&&(h=e.objectTop+e.objectHeight-e.maxHeight)),u(t,{left:p,top:h,right:m,bottom:v,offsetLeft:a,offsetTop:d,offsetRight:l,offsetBottom:f,start:e.start,move:(t,o)=>{g?e.objectWidth+=o.ox:y&&(e.objectWidth-=o.ox,e.objectLeft+=o.ox),x?e.objectHeight+=o.oy:j&&(e.objectHeight-=o.oy,e.objectTop+=o.oy),e.move?.(e.objectLeft,e.objectTop,e.objectWidth,e.objectHeight,o.x,o.y,o.border)},end:e.end})},t.scale=function(t,e){const o=t.currentTarget;if(o){if(t instanceof TouchEvent){if("touchend"===t.type)return void(t.touches.length||o.removeAttribute("data-scale"));const n=t.touches[0],i=t.touches[1],r=[n.clientX,i?.clientX??-1e3],s=[n.clientY,i?.clientY??-1e3],c=-1e3!==r[1],a=c?Math.hypot(r[0]-r[1],s[0]-s[1]):0,d=c?{x:(r[0]+r[1])/2,y:(s[0]+s[1])/2}:{x:r[0],y:s[0]};if(void 0===o.dataset.scale)return void(o.dataset.scale=JSON.stringify({dis:a,x:r,y:s,pos:d}));const u=JSON.parse(o.dataset.scale),l=c!==(-1e3!==u.x[1]),f=a>0&&u.dis>0?a/u.dis:1;return e(t,f,{x:l?0:d.x-u.pos.x,y:l?0:d.y-u.pos.y}),void(o.dataset.scale=JSON.stringify({dis:a,x:r,y:s,pos:d}))}if(t instanceof WheelEvent){if(!t.deltaY)return;const o=Math.abs(t.deltaY),n=o*(o>50?.0015:.003);return void e(t,t.deltaY<0?1+n:1-n,{x:0,y:0})}u(t,{move:(o,n)=>{e(t,1,{x:n.ox,y:n.oy})}})}},t.setCursor=c,t.setDragData=function(t){p=t}});
