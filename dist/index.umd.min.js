!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pointer={})}(this,function(t){"use strict";function e(t){return new Promise(e=>setTimeout(e,t))}function o(t){return"touch"===t.pointerType}function n(t){return{x:t.clientX,y:t.clientY}}function i(t,e){return Math.abs(e)>Math.abs(t)?e<0?"top":"bottom":t<0?"left":"right"}function r(t){return t instanceof PointerEvent?t.view??window:t.ownerDocument.defaultView??window}const s=/disabled/i;let a=null;function c(t){a||(a=document.createElement("style"),a.id="pointer-global-cursor",document.head.appendChild(a)),a.innerHTML=t?`*, *::after, *::before {cursor: ${t} !important;}`:""}function d(t,e){const o=t.target,s=r(t);let a,{x:c,y:d}=n(t),l=!1;const p=function(t){t.target&&t.target.ownerDocument.body.contains(t.target)||!t.cancelable||t.preventDefault();const{x:o,y:r}=n(t);if(o===c&&r===d)return;const f=i(o-c,r-d);if(c=o,d=r,!l&&(l=!0,!1===e.start?.(t)))return s.removeEventListener("pointermove",p),s.removeEventListener("pointerup",a),void s.removeEventListener("pointercancel",a);!1===e.move?.(t,f)&&(s.removeEventListener("pointermove",p),s.removeEventListener("pointerup",a),s.removeEventListener("pointercancel",a))};a=function(t){s.removeEventListener("pointermove",p),s.removeEventListener("pointerup",a),s.removeEventListener("pointercancel",a),e.up?.(t),l&&e.end?.(t)},o?.setPointerCapture?.(t.pointerId),s.addEventListener("pointermove",p,{passive:!1}),s.addEventListener("pointerup",a),s.addEventListener("pointercancel",a),e.down?.(t)}t.isMoving=!1;const l={down:[],up:[]};function p(t,e,o,n,i,r,s,a){let c=!1,d=!1;if(o<=i)c=!0,o<i&&t<e&&(t=e-s>i?i+s:e);else if(0!==a)n>=r&&(d=!0,n>r&&t>e&&(t=e+a<r?r-a:e));else{const o=r-1;t>=o&&(d=!0,t>o&&t>e&&(t=e<o?o:e))}return{val:t,atMin:c,atMax:d}}function f(e,o){t.isMoving=!0,c(o.cursor??getComputedStyle(e.target).cursor);let i,s,a,f,{x:u,y:v}=n(e);const m=r(e);if(o.areaObject){const t=o.areaObject.getBoundingClientRect(),e=getComputedStyle(o.areaObject);i=t.left+parseFloat(e.borderLeftWidth)+parseFloat(e.paddingLeft),s=t.top+parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop),a=t.left+t.width-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight),f=t.top+t.height-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight)}else i=o.left??0,s=o.top??0,a=o.right??m.innerWidth,f=o.bottom??m.innerHeight;i+=o.offsetLeft??0,s+=o.offsetTop??0,a+=o.offsetRight??0,f+=o.offsetBottom??0;let b=!1,g=0,h=0,y=0,x=0,L=0,j=0,w=0,E=0;const T=[];for(const t of l.down)t(e,o);return d(e,{start:()=>{if(!1===o.start?.(u,v))return c(),!1;if(o.object){const t=o.object.getBoundingClientRect();g=t.left,h=t.top,y=t.width,x=t.height}else g=o.objectLeft??0,h=o.objectTop??0,y=o.objectWidth??0,x=o.objectHeight??0;y>0&&(L=u-g),x>0&&(j=v-h),w=y-L,E=x-j},move:(t,e)=>{let{x:r,y:c}=n(t);if(r===u&&c===v)return;const d=p(r,u,r-L,r+w,i,a,L,w),l=p(c,v,c-j,c+E,s,f,j,E);r=d.val,c=l.val;const m=d.atMin,g=d.atMax,h=l.atMin,y=l.atMax,x=h||g||y||m,D=x?function(t,e,o,n,i,r,s,a,c,d){return t&&n?"lt":t&&e?"tr":o&&e?"rb":o&&n?"bl":t?i-s<=20?"lt":c-i<=20?"tr":"t":e?r-a<=20?"tr":d-r<=20?"rb":"r":o?c-i<=20?"rb":i-s<=20?"bl":"b":n?r-a<=20?"lt":d-r<=20?"bl":"l":""}(h,g,y,m,r,c,i,s,a,f):"";x?b||(b=!0,o.borderIn?.(r,c,D,t)):b&&(b=!1,o.borderOut?.());const M=r-u,P=c-v;T.push({time:Date.now(),ox:M,oy:P}),o.move?.(t,{ox:M,oy:P,x:r,y:c,border:D,inBorder:{top:h,right:g,bottom:y,left:m},dir:e}),u=r,v=c},up:n=>{t.isMoving=!1,c();for(const t of l.up)t(e,o);o.up?.(T,n)},end:t=>{o.end?.(T,t)}}),{left:i,top:s,right:a,bottom:f}}function u(t,e){if(t.button>0)return;const o=t.clientX,n=t.clientY,i=Date.now();d(t,{up:t=>{if(Date.now()-i>=250)return;const r=t.clientX,s=t.clientY;r===o&&s===n&&e(t,r,s)}})}const v={time:0,x:0,y:0};let m,b=0;function g(t,e,o){const{x:i,y:r}=n(t);let s=0,a=0,c=!1,l=window.setTimeout(()=>{l=void 0,s<=1&&a<=1&&(c=!0,Promise.resolve(e(t)).catch(t=>{throw t}))},o?.time??300);d(t,{down:o?.down,move:t=>{const{x:e,y:o}=n(t);s=Math.abs(e-i),a=Math.abs(o-r)},up:()=>{o?.up?.(t),void 0!==l?(clearTimeout(l),l=void 0):c&&(b=Date.now())}})}function h(t,e){t?.dispatchEvent(new CustomEvent(e,{detail:{value:m}}))}const y={last:0,offset:0,done:!1,timer:0,firstTimer:!1,dir:""},x={top:"bottom",bottom:"top",left:"right",right:"left"};let L=null;function j(){return L||(L=document.createElement("div"),L.className="pointer-gesture",document.body.appendChild(L),L.insertAdjacentHTML("afterend","<style>.pointer-gesture{position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,.7);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));}.pointer-gesture-done::before{content:'';background:rgba(255,255,255,.9);border-radius:50%;width:10px;height:10px;}.pointer-gesture-ani{transition: all .3s cubic-bezier(.39,.575,.565,1);transition-property:left,top,transform;}</style>")),L}function w(t,e,o,n=!1){const i=j(),r=o/90;i.style.transform=`scale(${r})`;"top"===e||"bottom"===e?(i.style.left=`${t.left+(t.width-20)/2}px`,i.style.top=n?`${"top"===e?t.top+10:t.bottom-10}px`:`${"top"===e?t.top+o/1.5:t.bottom-20-o/1.5}px`):(i.style.top=`${t.top+(t.height-20)/2}px`,i.style.left=n?`${"left"===e?t.left+10:t.right-10}px`:`${"left"===e?t.left+o/1.5:t.right-20-o/1.5}px`)}t.addMoveHook=function(t,e){l[t].push(e)},t.allowEvent=function(t){return!(Date.now()-b<5)&&!function(t){for(;t;){if(s.test(t.className))return!0;for(const e in t.dataset)if(s.test(e))return!0;t=t.parentElement}return!1}(t.currentTarget)},t.click=u,t.dblClick=function(t,e){u(t,(t,o,n)=>{const i=Date.now();if(i-v.time<=300){const i=Math.abs(o-v.x),r=Math.abs(n-v.y);if(i<10&&r<10)return e(t,o,n),v.time=0,v.x=0,void(v.y=0)}v.time=i,v.x=o,v.y=n})},t.down=d,t.drag=function(t,e,o){m=o?.data;let n=0,i=0,r=null,s=null;f(t,{object:e,start:(t,r)=>{const a=e.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${a.left}px;top:${a.top}px;width:${a.width}px;height:${a.height}px;background:rgba(255,255,255,.8);border:1px dashed rgba(0,0,0,.8);filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));pointer-events:none;z-index:999999;`,s.style.borderRadius=getComputedStyle(e).borderRadius,document.body.appendChild(s),n=a.top,i=a.left,o?.start?.(t,r)},move:(t,a)=>{n+=a.oy,i+=a.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const c=document.elementsFromPoint(a.x,a.y);for(const t of c)if(void 0!==t.dataset.drop&&t!==e){if(t===r)return;return r&&(r.removeAttribute("data-hover"),h(r,"dragleave")),t.dataset.hover="",r=t,void h(r,"dragenter")}r&&(r.removeAttribute("data-hover"),h(r,"dragleave"),r=null),o?.move?.(t,a)},end:(t,e)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),h(r,"drop")),o?.end?.(t,e),m=void 0}})},t.gesture=function(t,o,r){const s=t.currentTarget;if(!s)return;const a=s.getBoundingClientRect(),c=j();if(t instanceof PointerEvent){let e=0,i=0,s=1,l="top";d(t,{move:(r,d)=>{if(s<0){if(s>-30){const t=o(r,l);1===t?(r.stopPropagation(),r.preventDefault()):-1===t&&r.stopPropagation(),--s}return}if(1===s){s=0,l=x[d];const e=o(r,l);if(1!==e)return-1===e&&r.stopPropagation(),void(s=-1);r.stopPropagation(),r.preventDefault();const{x:a,y:c}=n(t);i="top"===l||"bottom"===l?c:a}const{x:p,y:f}=n(r),u="top"===l||"bottom"===l?f:p;e="top"===l||"left"===l?u-i:i-u,e=Math.max(0,Math.min(90,e)),c.style.opacity=e>0?"1":"0",c.classList.toggle("pointer-gesture-done",e>=90),w(a,l,e)},end:()=>{c.style.opacity="0",e>=90&&r?.(l)}})}else(async()=>{const n=Date.now();if(n-y.last>250&&(y.offset=0,y.done=!1,y.timer=0,y.firstTimer=!1,y.dir=""),y.last=n,y.firstTimer||y.done)return;let s=t.deltaY,d=t.deltaX;if(""===y.dir){y.dir=i(d,s);const n=o(t,y.dir);if(1!==n)return void(-1===n?(t.stopPropagation(),y.done=!0):y.dir="");t.stopPropagation(),t.preventDefault(),w(a,y.dir,0,!0),y.firstTimer=!0,await e(30),y.firstTimer=!1,c.classList.add("pointer-gesture-ani")}const l="top"===y.dir||"bottom"===y.dir?s:d;if(y.offset+="top"===y.dir||"left"===y.dir?-l:l,y.offset<0)return y.offset=0,void(c.style.opacity="0");c.style.opacity="1";let p=Math.min(90,y.offset/1.38);c.classList.toggle("pointer-gesture-done",p>=90),w(a,y.dir,p),clearTimeout(y.timer),p<90?y.timer=window.setTimeout(()=>{c.style.opacity="0",c.classList.remove("pointer-gesture-ani")},250):(y.done=!0,r?.(y.dir),await e(500),c.style.opacity="0",c.classList.remove("pointer-gesture-ani"))})().catch(()=>{})},t.getDragData=function(){return m},t.getEventPos=n,t.getMoveDir=i,t.hover=function(t,e){const n=t.currentTarget;if(!n)return;const i=r(t);if(o(t)){if(n.dataset.pointerHover)return;n.dataset.pointerHover="1",e.enter?.(t);const o=function(t){e.move?.(t)},r=function(t){e.leave?.(t),delete n.dataset.pointerHover,n.removeEventListener("pointerleave",r),i.removeEventListener("pointermove",o),i.removeEventListener("pointerup",r),i.removeEventListener("pointercancel",r)};n.addEventListener("pointerleave",r),i.addEventListener("pointermove",o),i.addEventListener("pointerup",r),i.addEventListener("pointercancel",r)}else{if("pointerdown"===t.type)return;e.enter?.(t);const o=function(t){e.move?.(t)},r=function(t){e.leave?.(t),i.removeEventListener("pointermove",o),n.removeEventListener("pointerleave",r)};i.addEventListener("pointermove",o),n.addEventListener("pointerleave",r)}},t.isTouch=o,t.long=g,t.menu=function(t,n){if(!t.currentTarget)return;const i=r(t);if(o(t)){const o=t=>{t.preventDefault()};return i.addEventListener("contextmenu",o),void g(t,n,{up:async()=>{await e(34),i.removeEventListener("contextmenu",o)}})}if(2!==t.button)return;const s=t=>{t.preventDefault(),n(t)};d(t,{up:async()=>{await e(34),i.removeEventListener("contextmenu",s)}}),i.addEventListener("contextmenu",s)},t.move=f,t.removeMoveHook=function(t,e){const o=l[t].indexOf(e);-1!==o&&l[t].splice(o,1)},t.resize=function(t,e){const o=e.minWidth??0,i=e.minHeight??0,{x:r,y:s}=n(t);let a,c,d,l,p,u,v,m;if(void 0===e.objectLeft||void 0===e.objectTop||void 0===e.objectWidth||void 0===e.objectHeight){if(!e.object)return;const t=e.object.getBoundingClientRect();e.objectLeft=t.left,e.objectTop=t.top,e.objectWidth=t.width,e.objectHeight=t.height}const b=e.border,g="tr"===b||"r"===b||"rb"===b,h="bl"===b||"l"===b||"lt"===b,y="rb"===b||"b"===b||"bl"===b,x="lt"===b||"t"===b||"tr"===b;g?(p=e.objectLeft+o,a=d=r-(e.objectLeft+e.objectWidth),e.maxWidth&&(v=e.objectLeft+e.maxWidth)):h&&(v=e.objectLeft+e.objectWidth-o,a=d=r-e.objectLeft,e.maxWidth&&(p=e.objectLeft+e.objectWidth-e.maxWidth)),y?(u=e.objectTop+i,c=l=s-(e.objectTop+e.objectHeight),e.maxHeight&&(m=e.objectTop+e.maxHeight)):x&&(m=e.objectTop+e.objectHeight-i,c=l=s-e.objectTop,e.maxHeight&&(u=e.objectTop+e.objectHeight-e.maxHeight)),f(t,{left:p,top:u,right:v,bottom:m,offsetLeft:a,offsetTop:c,offsetRight:d,offsetBottom:l,start:e.start,move:(t,o)=>{g?e.objectWidth+=o.ox:h&&(e.objectWidth-=o.ox,e.objectLeft+=o.ox),y?e.objectHeight+=o.oy:x&&(e.objectHeight-=o.oy,e.objectTop+=o.oy),e.move?.(e.objectLeft,e.objectTop,e.objectWidth,e.objectHeight,o.x,o.y,o.border)},end:e.end})},t.scale=function(t,e){if(t instanceof WheelEvent)return void function(t,e){if(!t.deltaY)return;t.preventDefault();const o=Math.abs(t.deltaY),n=o*(o>50?.0015:.003);e(t,t.deltaY<0?1+n:1-n,{x:0,y:0})}(t,e);const o=t.target;if(!o)return;const n={pointers:new Map,lastDis:0,lastPos:{x:0,y:0},lastSinglePos:{x:t.clientX,y:t.clientY}};let i;n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const s=t=>{if(n.pointers.has(t.pointerId))if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),n.pointers.size>=2){const o=Array.from(n.pointers.values()),i=Math.hypot(o[0].x-o[1].x,o[0].y-o[1].y),r={x:(o[0].x+o[1].x)/2,y:(o[0].y+o[1].y)/2},s=n.lastDis>0?i/n.lastDis:1,a=r.x-n.lastPos.x,c=r.y-n.lastPos.y;e(t,s,{x:a,y:c}),n.lastDis=i,n.lastPos=r}else{const o=t.clientX-n.lastSinglePos.x,i=t.clientY-n.lastSinglePos.y;0===o&&0===i||(e(t,1,{x:o,y:i}),n.lastSinglePos={x:t.clientX,y:t.clientY})}else if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},a=r(t),c=t=>{if(n.pointers.delete(t.pointerId),1===n.pointers.size){n.lastDis=0;const t=Array.from(n.pointers.values());n.lastSinglePos={x:t[0].x,y:t[0].y}}0===n.pointers.size&&(a.removeEventListener("pointermove",s),a.removeEventListener("pointerup",c),a.removeEventListener("pointercancel",c),a.removeEventListener("pointerdown",i))};i=t=>{if(o.setPointerCapture?.(t.pointerId),n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},o.setPointerCapture?.(t.pointerId),a.addEventListener("pointermove",s,{passive:!1}),a.addEventListener("pointerup",c),a.addEventListener("pointercancel",c),a.addEventListener("pointerdown",i)},t.setCursor=c,t.setDragData=function(t){m=t}});
