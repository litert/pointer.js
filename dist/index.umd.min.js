!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pointer={})}(this,function(e){"use strict";function t(e,t=window){return new Promise(o=>t.setTimeout(o,e))}function o(e){return"number"==typeof e.pointerId&&"touch"===e.pointerType}function n(e){return{x:e.clientX,y:e.clientY}}function i(e,t){return Math.abs(t)>Math.abs(e)?t<0?"top":"bottom":e<0?"left":"right"}function r(e){return"view"in e&&e.view?e.view:"ownerDocument"in e&&e.ownerDocument?e.ownerDocument.defaultView??window:window}const s=/disabled/i;let a=null;function c(e){a||(a=document.createElement("style"),a.id="pointer-global-cursor",document.head.appendChild(a)),a.innerHTML=e?`*, *::after, *::before {cursor: ${e} !important;}`:""}function p(e,t){const o=r(e);let{x:s,y:a}=n(e),c=!1;const p=e.type.startsWith("pointer");let l;const d=function(e){e.target&&e.target.ownerDocument.body.contains(e.target)||!e.cancelable||e.preventDefault();const{x:r,y:u}=n(e);if(r===s&&u===a)return;const f=i(r-s,u-a);s=r,a=u,c||(c=!0,!1!==t.start?.(e))?!1===t.move?.(e,f)&&(p?(o.removeEventListener("pointermove",d),o.removeEventListener("pointerup",l),o.removeEventListener("pointercancel",l)):(o.removeEventListener("mousemove",d),o.removeEventListener("mouseup",l))):p?(o.removeEventListener("pointermove",d),o.removeEventListener("pointerup",l),o.removeEventListener("pointercancel",l)):(o.removeEventListener("mousemove",d),o.removeEventListener("mouseup",l))};l=function(e){p?(o.removeEventListener("pointermove",d),o.removeEventListener("pointerup",l),o.removeEventListener("pointercancel",l)):(o.removeEventListener("mousemove",d),o.removeEventListener("mouseup",l)),t.up?.(e),c&&t.end?.(e)},p?(o.addEventListener("pointermove",d,{passive:!1}),o.addEventListener("pointerup",l),o.addEventListener("pointercancel",l)):(o.addEventListener("mousemove",d,{passive:!1}),o.addEventListener("mouseup",l)),t.down?.(e)}e.isMoving=!1;const l={down:[],up:[]};function d(e,t,o,n,i,r,s,a){let c=!1,p=!1;if(o<=i)c=!0,o<i&&e<t&&(e=t-s>i?i+s:t);else if(0!==a)n>=r&&(p=!0,n>r&&e>t&&(e=t+a<r?r-a:t));else{const o=r-1;e>=o&&(p=!0,e>o&&e>t&&(e=t<o?o:t))}return{val:e,atMin:c,atMax:p}}function u(t,o){e.isMoving=!0,c(o.cursor??getComputedStyle(t.target).cursor);let i,s,a,u,{x:f,y:v}=n(t);const m=r(t);if(o.areaObject){const e=o.areaObject.getBoundingClientRect(),t=getComputedStyle(o.areaObject);i=e.left+parseFloat(t.borderLeftWidth)+parseFloat(t.paddingLeft),s=e.top+parseFloat(t.borderTopWidth)+parseFloat(t.paddingTop),a=e.left+e.width-parseFloat(t.borderRightWidth)-parseFloat(t.paddingRight),u=e.top+e.height-parseFloat(t.borderBottomWidth)-parseFloat(t.paddingBottom)}else i=o.left??0,s=o.top??0,a=o.right??m.innerWidth,u=o.bottom??m.innerHeight;i+=o.offsetLeft??0,s+=o.offsetTop??0,a+=o.offsetRight??0,u+=o.offsetBottom??0;let b=!1,h=0,g=0,y=0,x=0,L=0,E=0,j=0,w=0;const D=[];for(const e of l.down)e(t,o);return p(t,{start:()=>{if(!1===o.start?.(f,v))return c(),!1;if(o.object){const e=o.object.getBoundingClientRect();h=e.left,g=e.top,y=e.width,x=e.height}else h=o.objectLeft??0,g=o.objectTop??0,y=o.objectWidth??0,x=o.objectHeight??0;y>0&&(L=f-h),x>0&&(E=v-g),j=y-L,w=x-E},move:(e,t)=>{let{x:r,y:c}=n(e);if(r===f&&c===v)return;const p=d(r,f,r-L,r+j,i,a,L,j),l=d(c,v,c-E,c+w,s,u,E,w);r=p.val,c=l.val;const m=p.atMin,h=p.atMax,g=l.atMin,y=l.atMax,x=g||h||y||m,T=x?function(e,t,o,n,i,r,s,a,c,p){return e&&n?"lt":e&&t?"tr":o&&t?"rb":o&&n?"bl":e?i-s<=20?"lt":c-i<=20?"tr":"t":t?r-a<=20?"tr":p-r<=20?"rb":"r":o?c-i<=20?"rb":i-s<=20?"bl":"b":n?r-a<=20?"lt":p-r<=20?"bl":"l":""}(g,h,y,m,r,c,i,s,a,u):"";x?b||(b=!0,o.borderIn?.(r,c,T,e)):b&&(b=!1,o.borderOut?.());const M=r-f,P=c-v;D.push({time:Date.now(),ox:M,oy:P}),o.move?.(e,{ox:M,oy:P,x:r,y:c,border:T,inBorder:{top:g,right:h,bottom:y,left:m},dir:t}),f=r,v=c},up:n=>{e.isMoving=!1,c();for(const e of l.up)e(t,o);o.up?.(D,n)},end:e=>{o.end?.(D,e)}}),{left:i,top:s,right:a,bottom:u}}function f(e,t){if(e.button>0)return;const o=e.clientX,n=e.clientY,i=Date.now();p(e,{up:e=>{if(Date.now()-i>=250)return;const r=e.clientX,s=e.clientY;r===o&&s===n&&t(e,r,s)}})}const v={time:0,x:0,y:0};let m,b=0;function h(e,t,o){const{x:i,y:s}=n(e),a=r(e);let c=0,l=0,d=!1,u=a.setTimeout(()=>{u=void 0,c<=1&&l<=1&&(d=!0,Promise.resolve(t(e)).catch(e=>{throw e}))},o?.time??300);p(e,{down:o?.down,move:e=>{const{x:t,y:o}=n(e);c=Math.abs(t-i),l=Math.abs(o-s)},up:()=>{o?.up?.(e),void 0!==u?(a.clearTimeout(u),u=void 0):d&&(b=Date.now())}})}function g(e,t){e?.dispatchEvent(new CustomEvent(t,{detail:{value:m}}))}const y={last:0,offset:0,done:!1,timer:0,dir:""},x={top:"bottom",bottom:"top",left:"right",right:"left"};let L=null;function E(){return L||(L=document.createElement("div"),L.className="pointer-gesture",document.body.appendChild(L),L.insertAdjacentHTML("afterend","<style>.pointer-gesture{position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,.7);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));}.pointer-gesture-done::before{content:'';background:rgba(255,255,255,.9);border-radius:50%;width:10px;height:10px;}.pointer-gesture-ani{transition: all .3s cubic-bezier(.39,.575,.565,1);transition-property:left,top,transform;}</style>")),L}function j(e,t,o,n=!1){const i=E(),r=o/90;i.style.transform=`scale(${r})`;"top"===t||"bottom"===t?(i.style.left=`${e.left+(e.width-20)/2}px`,i.style.top=n?`${"top"===t?e.top+10:e.bottom-10}px`:`${"top"===t?e.top+o/1.5:e.bottom-20-o/1.5}px`):(i.style.top=`${e.top+(e.height-20)/2}px`,i.style.left=n?`${"left"===t?e.left+10:e.right-10}px`:`${"left"===t?e.left+o/1.5:e.right-20-o/1.5}px`)}e.addMoveHook=function(e,t){l[e].push(t)},e.allowEvent=function(e){return!(Date.now()-b<5)&&!function(e){for(;e;){if(s.test(e.className))return!0;for(const t in e.dataset)if(s.test(t))return!0;e=e.parentElement}return!1}(e.currentTarget)},e.click=f,e.dblClick=function(e,t){f(e,(e,o,n)=>{const i=Date.now();if(i-v.time<=300){const i=Math.abs(o-v.x),r=Math.abs(n-v.y);if(i<10&&r<10)return t(e,o,n),v.time=0,v.x=0,void(v.y=0)}v.time=i,v.x=o,v.y=n})},e.down=p,e.drag=function(e,t,o){m=o?.data;let n=0,i=0,r=null,s=null;u(e,{object:t,start:(e,r)=>{const a=t.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${a.left}px;top:${a.top}px;width:${a.width}px;height:${a.height}px;background:rgba(255,255,255,.8);border:1px dashed rgba(0,0,0,.8);filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));pointer-events:none;z-index:999999;`,s.style.borderRadius=getComputedStyle(t).borderRadius,document.body.appendChild(s),n=a.top,i=a.left,o?.start?.(e,r)},move:(e,a)=>{n+=a.oy,i+=a.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const c=document.elementsFromPoint(a.x,a.y);for(const e of c)if(void 0!==e.dataset.drop&&e!==t){if(e===r)return;return r&&(r.removeAttribute("data-hover"),g(r,"dragleave")),e.dataset.hover="",r=e,void g(r,"dragenter")}r&&(r.removeAttribute("data-hover"),g(r,"dragleave"),r=null),o?.move?.(e,a)},end:(e,t)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),g(r,"drop")),o?.end?.(e,t),m=void 0}})},e.gesture=function(e,o,s){const a=e.currentTarget;if(!a)return;const c=a.getBoundingClientRect(),l=E();if(e.type.startsWith("pointer")){let t=0,i=0,d=1,u="top",f=!1;const v=e=>{f&&e.cancelable&&e.preventDefault()},m=r(e),b=e;"touch"===b.pointerType&&m.addEventListener("touchmove",v,{passive:!1}),p(e,{move:(r,s)=>{const p=r;if(d<0){if(d>-30){const e=o(r,u);1===e?(f=!0,r.stopPropagation(),r.cancelable&&r.preventDefault(),a&&void 0!==p.pointerId&&a.setPointerCapture(p.pointerId)):-1===e&&r.stopPropagation(),--d}return}if(1===d){d=0,u=x[s];const t=o(r,u);if(1!==t)return-1===t&&r.stopPropagation(),void(d=-1);f=!0,r.stopPropagation(),r.cancelable&&r.preventDefault(),a&&void 0!==p.pointerId&&a.setPointerCapture(p.pointerId);const{x:c,y:l}=n(e);i="top"===u||"bottom"===u?l:c}const{x:v,y:m}=n(r),b="top"===u||"bottom"===u?m:v;t="top"===u||"left"===u?b-i:i-b,t=Math.max(0,Math.min(90,t)),l.style.opacity=t>0?"1":"0",l.classList.toggle("pointer-gesture-done",t>=90),j(c,u,t)},up:()=>{"touch"===b.pointerType&&m.removeEventListener("touchmove",v)},end:()=>{l.style.opacity="0",t>=90&&s?.(u)}})}else{const n=Date.now();if(n-y.last>250&&(y.offset=0,y.done=!1,y.timer=0,y.dir=""),y.last=n,""!==y.dir&&e.cancelable&&(e.stopPropagation(),e.preventDefault()),y.done)return;const a=e;let p=a.deltaY,d=a.deltaX;if(""===y.dir){y.dir=i(d,p);const e=o(a,y.dir);if(1!==e)return void(-1===e?(a.stopPropagation(),y.done=!0):y.dir="");a.stopPropagation(),a.cancelable&&a.preventDefault(),j(c,y.dir,0,!0),l.offsetWidth,l.classList.add("pointer-gesture-ani")}const u="top"===y.dir||"bottom"===y.dir?p:d;if(y.offset+="top"===y.dir||"left"===y.dir?-u:u,y.offset<0)return y.offset=0,void(l.style.opacity="0");l.style.opacity="1";let f=Math.min(90,y.offset/1.38);l.classList.toggle("pointer-gesture-done",f>=90),j(c,y.dir,f);const v=r(e);if(v.clearTimeout(y.timer),f<90)return void(y.timer=v.setTimeout(()=>{l.style.opacity="0",l.classList.remove("pointer-gesture-ani")},250));y.done=!0,s?.(y.dir),t(500).then(()=>{l.style.opacity="0",l.classList.remove("pointer-gesture-ani")}).catch(()=>{})}},e.getDragData=function(){return m},e.getEventPos=n,e.getMoveDir=i,e.hover=function(e,t){const n=e.currentTarget;if(!n)return;const i=r(e);if(o(e)){if(n.dataset.pointerHover)return;n.dataset.pointerHover="1",t.enter?.(e);const o=function(e){t.move?.(e)},r=function(e){t.leave?.(e),delete n.dataset.pointerHover,n.removeEventListener("pointerleave",r),i.removeEventListener("pointermove",o),i.removeEventListener("pointerup",r),i.removeEventListener("pointercancel",r)};n.addEventListener("pointerleave",r),i.addEventListener("pointermove",o),i.addEventListener("pointerup",r),i.addEventListener("pointercancel",r)}else{if("pointerdown"===e.type)return;t.enter?.(e);const o=function(e){t.move?.(e)},r=function(e){t.leave?.(e),i.removeEventListener("pointermove",o),n.removeEventListener("pointerleave",r)};i.addEventListener("pointermove",o),n.addEventListener("pointerleave",r)}},e.isTouch=o,e.long=h,e.menu=function(e,n){const i=r(e);if(o(e)){const o=e=>{e.preventDefault()};return i.addEventListener("contextmenu",o),void h(e,n,{up:async()=>{await t(34,i),i.removeEventListener("contextmenu",o)}})}if(2!==e.button)return;const s=e=>{e.preventDefault(),n(e)};p(e,{up:async()=>{await t(34,i),i.removeEventListener("contextmenu",s)}}),i.addEventListener("contextmenu",s)},e.move=u,e.removeMoveHook=function(e,t){const o=l[e].indexOf(t);-1!==o&&l[e].splice(o,1)},e.resize=function(e,t){const o=t.minWidth??0,i=t.minHeight??0,{x:r,y:s}=n(e);let a,c,p,l,d,f,v,m;if(void 0===t.objectLeft||void 0===t.objectTop||void 0===t.objectWidth||void 0===t.objectHeight){if(!t.object)return;const e=t.object.getBoundingClientRect();t.objectLeft=e.left,t.objectTop=e.top,t.objectWidth=e.width,t.objectHeight=e.height}const b=t.border,h="tr"===b||"r"===b||"rb"===b,g="bl"===b||"l"===b||"lt"===b,y="rb"===b||"b"===b||"bl"===b,x="lt"===b||"t"===b||"tr"===b;h?(d=t.objectLeft+o,a=p=r-(t.objectLeft+t.objectWidth),t.maxWidth&&(v=t.objectLeft+t.maxWidth)):g&&(v=t.objectLeft+t.objectWidth-o,a=p=r-t.objectLeft,t.maxWidth&&(d=t.objectLeft+t.objectWidth-t.maxWidth)),y?(f=t.objectTop+i,c=l=s-(t.objectTop+t.objectHeight),t.maxHeight&&(m=t.objectTop+t.maxHeight)):x&&(m=t.objectTop+t.objectHeight-i,c=l=s-t.objectTop,t.maxHeight&&(f=t.objectTop+t.objectHeight-t.maxHeight)),u(e,{left:d,top:f,right:v,bottom:m,offsetLeft:a,offsetTop:c,offsetRight:p,offsetBottom:l,start:t.start,move:(e,o)=>{h?t.objectWidth+=o.ox:g&&(t.objectWidth-=o.ox,t.objectLeft+=o.ox),y?t.objectHeight+=o.oy:x&&(t.objectHeight-=o.oy,t.objectTop+=o.oy),t.move?.(t.objectLeft,t.objectTop,t.objectWidth,t.objectHeight,o.x,o.y,o.border)},end:t.end})},e.scale=function(e,t){if("wheel"===e.type)return void function(e,t){if(!e.deltaY)return;e.preventDefault();const o=Math.abs(e.deltaY),n=o*(o>50?.0015:.003);t(e,e.deltaY<0?1+n:1-n,{x:0,y:0})}(e,t);if(!e.target)return;const o={pointers:new Map,lastDis:0,lastPos:{x:0,y:0},lastSinglePos:{x:e.clientX,y:e.clientY}};let n;o.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});const i=e=>{if(o.pointers.has(e.pointerId))if(o.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),o.pointers.size>=2){const n=Array.from(o.pointers.values()),i=Math.hypot(n[0].x-n[1].x,n[0].y-n[1].y),r={x:(n[0].x+n[1].x)/2,y:(n[0].y+n[1].y)/2},s=o.lastDis>0?i/o.lastDis:1,a=r.x-o.lastPos.x,c=r.y-o.lastPos.y;t(e,s,{x:a,y:c}),o.lastDis=i,o.lastPos=r}else{const n=e.clientX-o.lastSinglePos.x,i=e.clientY-o.lastSinglePos.y;0===n&&0===i||(t(e,1,{x:n,y:i}),o.lastSinglePos={x:e.clientX,y:e.clientY})}else if(o.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===o.pointers.size){const e=Array.from(o.pointers.values());o.lastDis=Math.hypot(e[0].x-e[1].x,e[0].y-e[1].y),o.lastPos={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2}}},s=r(e),a=e=>{if(o.pointers.delete(e.pointerId),1===o.pointers.size){o.lastDis=0;const e=Array.from(o.pointers.values());o.lastSinglePos={x:e[0].x,y:e[0].y}}0===o.pointers.size&&(s.removeEventListener("pointermove",i),s.removeEventListener("pointerup",a),s.removeEventListener("pointercancel",a),s.removeEventListener("pointerdown",n))};n=e=>{if(o.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===o.pointers.size){const e=Array.from(o.pointers.values());o.lastDis=Math.hypot(e[0].x-e[1].x,e[0].y-e[1].y),o.lastPos={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2}}},s.addEventListener("pointermove",i,{passive:!1}),s.addEventListener("pointerup",a),s.addEventListener("pointercancel",a),s.addEventListener("pointerdown",n)},e.setCursor=c,e.setDragData=function(e){m=e}});
