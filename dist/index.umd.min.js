!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pointer={})}(this,function(t){"use strict";function e(t){return{x:t.clientX,y:t.clientY}}function o(t,e){return Math.abs(e)>Math.abs(t)?e<0?"top":"bottom":t<0?"left":"right"}const n=/disabled/i;let i=null;function r(t){i||(i=document.createElement("style"),i.id="pointer-global-cursor",document.head.appendChild(i)),i.innerHTML=t?`*, *::after, *::before {cursor: ${t} !important;}`:""}function s(t,n){const i=t.target;let r,{x:s,y:a}=e(t),d=!1;const c=function(t){t.target&&document.body.contains(t.target)||!t.cancelable||t.preventDefault();const{x:i,y:l}=e(t);if(i===s&&l===a)return;const p=o(i-s,l-a);if(s=i,a=l,!d&&(d=!0,!1===n.start?.(t)))return window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),void window.removeEventListener("pointercancel",r);!1===n.move?.(t,p)&&(window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r))};r=function(t){window.removeEventListener("pointermove",c),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r),n.up?.(t),d&&n.end?.(t)},i?.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",c,{passive:!1}),window.addEventListener("pointerup",r),window.addEventListener("pointercancel",r),n.down?.(t)}t.isMoving=!1;const a={down:[],up:[]};function d(t,e,o,n,i,r,s,a){let d=!1,c=!1;if(o<=i)d=!0,o<i&&t<e&&(t=e-s>i?i+s:e);else if(0!==a)n>=r&&(c=!0,n>r&&t>e&&(t=e+a<r?r-a:e));else{const o=r-1;t>=o&&(c=!0,t>o&&t>e&&(t=e<o?o:e))}return{val:t,atMin:d,atMax:c}}function c(o,n){t.isMoving=!0,r(n.cursor??getComputedStyle(o.target).cursor);let i,c,l,p,{x:f,y:u}=e(o);if(n.areaObject){const t=n.areaObject.getBoundingClientRect(),e=getComputedStyle(n.areaObject);i=t.left+parseFloat(e.borderLeftWidth)+parseFloat(e.paddingLeft),c=t.top+parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop),l=t.left+t.width-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight),p=t.top+t.height-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight)}else i=n.left??0,c=n.top??0,l=n.right??window.innerWidth,p=n.bottom??window.innerHeight;i+=n.offsetLeft??0,c+=n.offsetTop??0,l+=n.offsetRight??0,p+=n.offsetBottom??0;let b=!1,m=0,h=0,g=0,v=0,y=0,x=0,w=0,j=0;const L=[];for(const t of a.down)t(o,n);return s(o,{start:()=>{if(!1===n.start?.(f,u))return r(),!1;if(n.object){const t=n.object.getBoundingClientRect();m=t.left,h=t.top,g=t.width,v=t.height}else m=n.objectLeft??0,h=n.objectTop??0,g=n.objectWidth??0,v=n.objectHeight??0;g>0&&(y=f-m),v>0&&(x=u-h),w=g-y,j=v-x},move:(t,o)=>{let{x:r,y:s}=e(t);if(r===f&&s===u)return;const a=d(r,f,r-y,r+w,i,l,y,w),m=d(s,u,s-x,s+j,c,p,x,j);r=a.val,s=m.val;const h=a.atMin,g=a.atMax,v=m.atMin,T=m.atMax,E=v||g||T||h,M=E?function(t,e,o,n,i,r,s,a,d,c){return t&&n?"lt":t&&e?"tr":o&&e?"rb":o&&n?"bl":t?i-s<=20?"lt":d-i<=20?"tr":"t":e?r-a<=20?"tr":c-r<=20?"rb":"r":o?d-i<=20?"rb":i-s<=20?"bl":"b":n?r-a<=20?"lt":c-r<=20?"bl":"l":""}(v,g,T,h,r,s,i,c,l,p):"";E?b||(b=!0,n.borderIn?.(r,s,M,t)):b&&(b=!1,n.borderOut?.());const P=r-f,D=s-u;L.push({time:Date.now(),ox:P,oy:D}),n.move?.(t,{ox:P,oy:D,x:r,y:s,border:M,inBorder:{top:v,right:g,bottom:T,left:h},dir:o}),f=r,u=s},up:e=>{t.isMoving=!1,r();for(const t of a.up)t(L,o,n);n.up?.(L,e)},end:t=>{n.end?.(L,t)}}),{left:i,top:c,right:l,bottom:p}}function l(t,e){if(t.button>0)return;const o=t.clientX,n=t.clientY,i=Date.now();s(t,{up:t=>{if(Date.now()-i>=250)return;const r=t.clientX,s=t.clientY;r===o&&s===n&&e(t,r,s)}})}const p={time:0,x:0,y:0};let f,u=0;function b(t,e){t?.dispatchEvent(new CustomEvent(e,{detail:{value:f}}))}const m={last:0,offset:0,done:!1,timer:0,firstTimer:!1,dir:""},h={top:"bottom",bottom:"top",left:"right",right:"left"};let g=null;function v(){return g||(g=document.createElement("div"),g.className="pointer-gesture",document.body.appendChild(g),g.insertAdjacentHTML("afterend","<style>.pointer-gesture{position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,.7);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));}.pointer-gesture-done::before{content:'';background:rgba(255,255,255,.9);border-radius:50%;width:10px;height:10px;}</style>")),g}function y(t,e,o,n=!1){const i=v(),r=o/90;i.style.transform=`scale(${r})`;"top"===e||"bottom"===e?(i.style.left=`${t.left+(t.width-20)/2}px`,i.style.top=n?`${"top"===e?t.top+10:t.bottom-10}px`:`${"top"===e?t.top+o/1.5:t.bottom-20-o/1.5}px`):(i.style.top=`${t.top+(t.height-20)/2}px`,i.style.left=n?`${"left"===e?t.left+10:t.right-10}px`:`${"left"===e?t.left+o/1.5:t.right-20-o/1.5}px`)}function x(t){return new Promise(e=>setTimeout(e,t))}t.addMoveHook=function(t,e){a[t].push(e)},t.allowEvent=function(t){return!(Date.now()-u<5)&&!function(t){for(;t;){if(n.test(t.className))return!0;for(const e in t.dataset)if(n.test(e))return!0;t=t.parentElement}return!1}(t.currentTarget)},t.click=l,t.dblClick=function(t,e){l(t,(t,o,n)=>{const i=Date.now();if(i-p.time<=300){const i=Math.abs(o-p.x),r=Math.abs(n-p.y);if(i<10&&r<10)return e(t,o,n),p.time=0,p.x=0,void(p.y=0)}p.time=i,p.x=o,p.y=n})},t.down=s,t.drag=function(t,e,o){f=o?.data;let n=0,i=0,r=null,s=null;c(t,{object:e,start:(t,r)=>{const a=e.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${a.left}px;top:${a.top}px;width:${a.width}px;height:${a.height}px;background:rgba(255,255,255,.8);border:1px dashed rgba(0,0,0,.8);filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));pointer-events:none;z-index:999999;`,s.style.borderRadius=getComputedStyle(e).borderRadius,document.body.appendChild(s),n=a.top,i=a.left,o?.start?.(t,r)},move:(t,a)=>{n+=a.oy,i+=a.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const d=document.elementsFromPoint(a.x,a.y);for(const t of d)if(void 0!==t.dataset.drop&&t!==e){if(t===r)return;return r&&(r.removeAttribute("data-hover"),b(r,"dragleave")),t.dataset.hover="",r=t,void b(r,"dragenter")}r&&(r.removeAttribute("data-hover"),b(r,"dragleave"),r=null),o?.move?.(t,a)},end:(t,e)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),b(r,"drop")),o?.end?.(t,e),f=void 0}})},t.gesture=function(t,n,i){const r=t.currentTarget;if(!r)return;const a=r.getBoundingClientRect(),d=v();if(t instanceof PointerEvent){let o=0,r=0,c=1,l="top";s(t,{move:(i,s)=>{if(c<0){if(c>-30){const t=n(i,l);1===t?(i.stopPropagation(),i.preventDefault()):-1===t&&i.stopPropagation(),--c}return}if(1===c){c=0,l=h[s];const o=n(i,l);if(1!==o)return-1===o&&i.stopPropagation(),void(c=-1);i.stopPropagation(),i.preventDefault();const{x:a,y:d}=e(t);r="top"===l||"bottom"===l?d:a}const{x:p,y:f}=e(i),u="top"===l||"bottom"===l?f:p;o="top"===l||"left"===l?u-r:r-u,o=Math.max(0,Math.min(90,o)),d.style.opacity=o>0?"1":"0",d.classList.toggle("pointer-gesture-done",o>=90),y(a,l,o)},end:()=>{d.style.opacity="0",o>=90&&i?.(l)}})}else(async()=>{const e=Date.now();if(e-m.last>250&&(m.offset=0,m.done=!1,m.timer=0,m.firstTimer=!1,m.dir=""),m.last=e,m.firstTimer||m.done)return;let r=t.deltaY,s=t.deltaX;if(""===m.dir){m.dir=o(s,r);const e=n(t,m.dir);if(1!==e)return void(-1===e?(t.stopPropagation(),m.done=!0):m.dir="");t.stopPropagation(),t.preventDefault(),y(a,m.dir,0,!0),m.firstTimer=!0,await x(30),m.firstTimer=!1,d.classList.add("ani")}const c="top"===m.dir||"bottom"===m.dir?r:s;if(m.offset+="top"===m.dir||"left"===m.dir?-c:c,m.offset<0)return m.offset=0,void(d.style.opacity="0");d.style.opacity="1";let l=Math.min(90,m.offset/1.38);d.classList.toggle("pointer-gesture-done",l>=90),y(a,m.dir,l),clearTimeout(m.timer),l<90?m.timer=window.setTimeout(()=>{d.style.opacity="0",d.classList.remove("ani")},250):(m.done=!0,i?.(m.dir),await x(500),d.style.opacity="0",d.classList.remove("ani"))})().catch(()=>{})},t.getDragData=function(){return f},t.getEventPos=e,t.getMoveDir=o,t.isTouch=function(t){return"touch"===t.pointerType},t.long=function(t,o,n){const{x:i,y:r}=e(t);let a=0,d=0,c=!1,l=window.setTimeout(()=>{l=void 0,a<=1&&d<=1&&(c=!0,Promise.resolve(o(t)).catch(t=>{throw t}))},n??300);s(t,{move:t=>{const{x:o,y:n}=e(t);a=Math.abs(o-i),d=Math.abs(n-r)},up:()=>{void 0!==l?(clearTimeout(l),l=void 0):c&&(u=Date.now())}})},t.move=c,t.removeMoveHook=function(t,e){const o=a[t].indexOf(e);-1!==o&&a[t].splice(o,1)},t.resize=function(t,o){const n=o.minWidth??0,i=o.minHeight??0,{x:r,y:s}=e(t);let a,d,l,p,f,u,b,m;if(void 0===o.objectLeft||void 0===o.objectTop||void 0===o.objectWidth||void 0===o.objectHeight){if(!o.object)return;const t=o.object.getBoundingClientRect();o.objectLeft=t.left,o.objectTop=t.top,o.objectWidth=t.width,o.objectHeight=t.height}const h=o.border,g="tr"===h||"r"===h||"rb"===h,v="bl"===h||"l"===h||"lt"===h,y="rb"===h||"b"===h||"bl"===h,x="lt"===h||"t"===h||"tr"===h;g?(f=o.objectLeft+n,a=l=r-(o.objectLeft+o.objectWidth),o.maxWidth&&(b=o.objectLeft+o.maxWidth)):v&&(b=o.objectLeft+o.objectWidth-n,a=l=r-o.objectLeft,o.maxWidth&&(f=o.objectLeft+o.objectWidth-o.maxWidth)),y?(u=o.objectTop+i,d=p=s-(o.objectTop+o.objectHeight),o.maxHeight&&(m=o.objectTop+o.maxHeight)):x&&(m=o.objectTop+o.objectHeight-i,d=p=s-o.objectTop,o.maxHeight&&(u=o.objectTop+o.objectHeight-o.maxHeight)),c(t,{left:f,top:u,right:b,bottom:m,offsetLeft:a,offsetTop:d,offsetRight:l,offsetBottom:p,start:o.start,move:(t,e)=>{g?o.objectWidth+=e.ox:v&&(o.objectWidth-=e.ox,o.objectLeft+=e.ox),y?o.objectHeight+=e.oy:x&&(o.objectHeight-=e.oy,o.objectTop+=e.oy),o.move?.(o.objectLeft,o.objectTop,o.objectWidth,o.objectHeight,e.x,e.y,e.border)},end:o.end})},t.scale=function(t,e){if(t instanceof WheelEvent)return void function(t,e){if(!t.deltaY)return;t.preventDefault();const o=Math.abs(t.deltaY),n=o*(o>50?.0015:.003);e(t,t.deltaY<0?1+n:1-n,{x:0,y:0})}(t,e);const o=t.target;if(!o)return;const n={pointers:new Map,lastDis:0,lastPos:{x:0,y:0},lastSinglePos:{x:t.clientX,y:t.clientY}};let i;n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const r=t=>{if(n.pointers.has(t.pointerId))if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),n.pointers.size>=2){const o=Array.from(n.pointers.values()),i=Math.hypot(o[0].x-o[1].x,o[0].y-o[1].y),r={x:(o[0].x+o[1].x)/2,y:(o[0].y+o[1].y)/2},s=n.lastDis>0?i/n.lastDis:1,a=r.x-n.lastPos.x,d=r.y-n.lastPos.y;e(t,s,{x:a,y:d}),n.lastDis=i,n.lastPos=r}else{const o=t.clientX-n.lastSinglePos.x,i=t.clientY-n.lastSinglePos.y;0===o&&0===i||(e(t,1,{x:o,y:i}),n.lastSinglePos={x:t.clientX,y:t.clientY})}else if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},s=t=>{if(n.pointers.delete(t.pointerId),1===n.pointers.size){n.lastDis=0;const t=Array.from(n.pointers.values());n.lastSinglePos={x:t[0].x,y:t[0].y}}0===n.pointers.size&&(window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",s),window.removeEventListener("pointerdown",i))};i=t=>{if(o.setPointerCapture?.(t.pointerId),n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},o.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",r,{passive:!1}),window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s),window.addEventListener("pointerdown",i)},t.setCursor=r,t.setDragData=function(t){f=t}});
