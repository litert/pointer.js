!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pointer={})}(this,function(t){"use strict";function e(t){return{x:t.clientX,y:t.clientY}}function o(t,e){return Math.abs(e)>Math.abs(t)?e<0?"top":"bottom":t<0?"left":"right"}const n=/disabled/i;let i=null;function r(t){i||(i=document.createElement("style"),i.id="pointer-global-cursor",document.head.appendChild(i)),i.innerHTML=t?`*, *::after, *::before {cursor: ${t} !important;}`:""}function s(t,n){const i=t.target;let r,{x:s,y:a}=e(t),c=!1;const l=function(t){t.target&&document.body.contains(t.target)||!t.cancelable||t.preventDefault();const{x:i,y:d}=e(t);if(i===s&&d===a)return;const p=o(i-s,d-a);if(s=i,a=d,!c&&(c=!0,!1===n.start?.(t)))return window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",r),void window.removeEventListener("pointercancel",r);!1===n.move?.(t,p)&&(window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r))};r=function(t){window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r),n.up?.(t),c&&n.end?.(t)},i?.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",l,{passive:!1}),window.addEventListener("pointerup",r),window.addEventListener("pointercancel",r),n.down?.(t)}function a(t,e,o,n,i,r,s,a){let c=!1,l=!1;if(o<=i)c=!0,o<i&&t<e&&(t=e-s>i?i+s:e);else if(0!==a)n>=r&&(l=!0,n>r&&t>e&&(t=e+a<r?r-a:e));else{const o=r-1;t>=o&&(l=!0,t>o&&t>e&&(t=e<o?o:e))}return{val:t,atMin:c,atMax:l}}function c(o,n){const i=o.target;t.isMoving=!0,r(n.cursor??getComputedStyle(o.target).cursor);let c,l,d,p,{x:f,y:u}=e(o);if(n.areaObject){const t=n.areaObject.getBoundingClientRect(),e=getComputedStyle(n.areaObject);c=t.left+parseFloat(e.borderLeftWidth)+parseFloat(e.paddingLeft),l=t.top+parseFloat(e.borderTopWidth)+parseFloat(e.paddingTop),d=t.left+t.width-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight),p=t.top+t.height-parseFloat(e.borderRightWidth)-parseFloat(e.paddingRight)}else c=n.left??0,l=n.top??0,d=n.right??window.innerWidth,p=n.bottom??window.innerHeight;c+=n.offsetLeft??0,l+=n.offsetTop??0,d+=n.offsetRight??0,p+=n.offsetBottom??0;let m=!1,h=0,b=0,v=0,g=0,y=0,x=0,w=0,j=0;const L=[];return i.style.touchAction="none",s(o,{start:()=>{if(!1===n.start?.(f,u))return r(),!1;if(n.object){const t=n.object.getBoundingClientRect();h=t.left,b=t.top,v=t.width,g=t.height}else h=n.objectLeft??0,b=n.objectTop??0,v=n.objectWidth??0,g=n.objectHeight??0;v>0&&(y=f-h),g>0&&(x=u-b),w=v-y,j=g-x},move:(t,o)=>{let{x:i,y:r}=e(t);if(i===f&&r===u)return;const s=a(i,f,i-y,i+w,c,d,y,w),h=a(r,u,r-x,r+j,l,p,x,j);i=s.val,r=h.val;const b=s.atMin,v=s.atMax,g=h.atMin,T=h.atMax,E=g||v||T||b,M=E?function(t,e,o,n,i,r,s,a,c,l){return t?i-s<=20?"lt":c-i<=20?"tr":"t":e?r-a<=20?"tr":l-r<=20?"rb":"r":o?c-i<=20?"rb":i-s<=20?"bl":"b":n?r-a<=20?"lt":l-r<=20?"bl":"l":""}(g,v,T,b,i,r,c,l,d,p):"";E?m||(m=!0,n.borderIn?.(i,r,M,t)):m&&(m=!1,n.borderOut?.());const P=i-f,D=r-u;L.push({time:Date.now(),ox:P,oy:D}),n.move?.(t,{ox:P,oy:D,x:i,y:r,border:M,inBorder:{top:g,right:v,bottom:T,left:b},dir:o}),f=i,u=r},up:e=>{t.isMoving=!1,r(),n.up?.(L,e)},end:t=>{n.end?.(L,t),i.style.touchAction=""}}),{left:c,top:l,right:d,bottom:p}}function l(t,e){if(t.button>0)return;const o=t.clientX,n=t.clientY,i=Date.now();s(t,{up:t=>{if(Date.now()-i>=250)return;const r=t.clientX,s=t.clientY;r===o&&s===n&&e(t,r,s)}})}t.isMoving=!1;const d={time:0,x:0,y:0};let p,f=0;function u(t,e){t?.dispatchEvent(new CustomEvent(e,{detail:{value:p}}))}const m={last:0,offset:0,done:!1,timer:0,firstTimer:!1,dir:""},h={top:"bottom",bottom:"top",left:"right",right:"left"};let b=null;function v(){return b||(b=document.createElement("div"),b.className="pointer-gesture",b.style.cssText="position:fixed;width:20px;height:20px;border-radius:50%;background:rgba(0,0,0,0.3);pointer-events:none;z-index:999999;opacity:0;transition:opacity 0.2s;transform-origin:center;",document.body.appendChild(b)),b}function g(t,e,o,n=!1){const i=v(),r=o/90;i.style.transform=`scale(${r})`;"top"===e||"bottom"===e?(i.style.left=`${t.left+(t.width-20)/2}px`,i.style.top=n?`${"top"===e?t.top+10:t.bottom-10}px`:`${"top"===e?t.top+o/1.5:t.bottom-20-o/1.5}px`):(i.style.top=`${t.top+(t.height-20)/2}px`,i.style.left=n?`${"left"===e?t.left+10:t.right-10}px`:`${"left"===e?t.left+o/1.5:t.right-20-o/1.5}px`)}function y(t){return new Promise(e=>setTimeout(e,t))}t.allowEvent=function(t){return!(Date.now()-f<5)&&!function(t){for(;t;){if(n.test(t.className))return!0;for(const e in t.dataset)if(n.test(e))return!0;t=t.parentElement}return!1}(t.currentTarget)},t.click=l,t.dblClick=function(t,e){l(t,(t,o,n)=>{const i=Date.now();if(i-d.time<=300){const i=Math.abs(o-d.x),r=Math.abs(n-d.y);if(i<10&&r<10)return e(t,o,n),d.time=0,d.x=0,void(d.y=0)}d.time=i,d.x=o,d.y=n})},t.down=s,t.drag=function(t,e,o){p=o?.data;let n=0,i=0,r=null,s=null;c(t,{object:e,start:(t,r)=>{const a=e.getBoundingClientRect();s=document.createElement("div"),s.style.cssText=`position:fixed;left:${a.left}px;top:${a.top}px;width:${a.width}px;height:${a.height}px;background:rgba(0,0,0,0.1);border:1px dashed #666;pointer-events:none;z-index:999999;`,document.body.appendChild(s),n=a.top,i=a.left,o?.start?.(t,r)},move:(t,a)=>{n+=a.oy,i+=a.ox,s&&(s.style.left=`${i}px`,s.style.top=`${n}px`);const c=document.elementsFromPoint(a.x,a.y);for(const t of c)if(void 0!==t.dataset.drop&&t!==e){if(t===r)return;return r&&(r.removeAttribute("data-hover"),u(r,"dragleave")),t.dataset.hover="",r=t,void u(r,"dragenter")}r&&(r.removeAttribute("data-hover"),u(r,"dragleave"),r=null),o?.move?.(t,a)},end:(t,e)=>{s&&(s.remove(),s=null),r&&(r.removeAttribute("data-hover"),u(r,"drop")),o?.end?.(t,e),p=void 0}})},t.gesture=function(t,n,i){const r=t.currentTarget;if(!r)return;const a=r.getBoundingClientRect(),c=v();if(t instanceof PointerEvent){let o=0,r=0,l=1,d="top";s(t,{move:(i,s)=>{if(l<0){if(l>-30){const t=n(i,d);1===t?(i.stopPropagation(),i.preventDefault()):-1===t&&i.stopPropagation(),--l}return}if(1===l){l=0,d=h[s];const o=n(i,d);if(1!==o)return-1===o&&i.stopPropagation(),void(l=-1);i.stopPropagation(),i.preventDefault();const{x:a,y:c}=e(t);r="top"===d||"bottom"===d?c:a}const{x:p,y:f}=e(i),u="top"===d||"bottom"===d?f:p;o="top"===d||"left"===d?u-r:r-u,o=Math.max(0,Math.min(90,o)),c.style.opacity=o>0?"1":"0",c.classList.toggle("done",o>=90),g(a,d,o)},end:()=>{c.style.opacity="0",o>=90&&i?.(d)}})}else(async()=>{const e=Date.now();if(e-m.last>250&&(m.offset=0,m.done=!1,m.timer=0,m.firstTimer=!1,m.dir=""),m.last=e,m.firstTimer||m.done)return;let r=t.deltaY,s=t.deltaX;if(""===m.dir){m.dir=o(s,r);const e=n(t,m.dir);if(1!==e)return void(-1===e?(t.stopPropagation(),m.done=!0):m.dir="");t.stopPropagation(),t.preventDefault(),g(a,m.dir,0,!0),m.firstTimer=!0,await y(30),m.firstTimer=!1,c.classList.add("ani")}const l="top"===m.dir||"bottom"===m.dir?r:s;if(m.offset+="top"===m.dir||"left"===m.dir?-l:l,m.offset<0)return m.offset=0,void(c.style.opacity="0");c.style.opacity="1";let d=Math.min(90,m.offset/1.38);c.classList.toggle("done",d>=90),g(a,m.dir,d),clearTimeout(m.timer),d<90?m.timer=window.setTimeout(()=>{c.style.opacity="0",c.classList.remove("ani")},250):(m.done=!0,i?.(m.dir),await y(500),c.style.opacity="0",c.classList.remove("ani"))})().catch(()=>{})},t.getDragData=function(){return p},t.getEventPos=e,t.getMoveDir=o,t.isTouch=function(t){return"touch"===t.pointerType},t.long=function(t,o){const{x:n,y:i}=e(t);let r=0,a=0,c=!1,l=window.setTimeout(()=>{l=void 0,r<=1&&a<=1&&(c=!0,Promise.resolve(o(t)).catch(t=>{throw t}))},300);s(t,{move:t=>{const{x:o,y:s}=e(t);r=Math.abs(o-n),a=Math.abs(s-i)},up:()=>{void 0!==l?(clearTimeout(l),l=void 0):c&&(f=Date.now())}})},t.move=c,t.resize=function(t,o){const n=o.minWidth??0,i=o.minHeight??0,{x:r,y:s}=e(t);let a,l,d,p,f,u,m,h;if(void 0===o.objectLeft||void 0===o.objectTop||void 0===o.objectWidth||void 0===o.objectHeight){if(!o.object)return;const t=o.object.getBoundingClientRect();o.objectLeft=t.left,o.objectTop=t.top,o.objectWidth=t.width,o.objectHeight=t.height}const b=o.border,v="tr"===b||"r"===b||"rb"===b,g="bl"===b||"l"===b||"lt"===b,y="rb"===b||"b"===b||"bl"===b,x="lt"===b||"t"===b||"tr"===b;v?(f=o.objectLeft+n,a=d=r-(o.objectLeft+o.objectWidth),o.maxWidth&&(m=o.objectLeft+o.maxWidth)):g&&(m=o.objectLeft+o.objectWidth-n,a=d=r-o.objectLeft,o.maxWidth&&(f=o.objectLeft+o.objectWidth-o.maxWidth)),y?(u=o.objectTop+i,l=p=s-(o.objectTop+o.objectHeight),o.maxHeight&&(h=o.objectTop+o.maxHeight)):x&&(h=o.objectTop+o.objectHeight-i,l=p=s-o.objectTop,o.maxHeight&&(u=o.objectTop+o.objectHeight-o.maxHeight)),c(t,{left:f,top:u,right:m,bottom:h,offsetLeft:a,offsetTop:l,offsetRight:d,offsetBottom:p,start:o.start,move:(t,e)=>{v?o.objectWidth+=e.ox:g&&(o.objectWidth-=e.ox,o.objectLeft+=e.ox),y?o.objectHeight+=e.oy:x&&(o.objectHeight-=e.oy,o.objectTop+=e.oy),o.move?.(o.objectLeft,o.objectTop,o.objectWidth,o.objectHeight,e.x,e.y,e.border)},end:o.end})},t.scale=function(t,e){const o=t.target;if(!o)return;const n={pointers:new Map,lastDis:0,lastPos:{x:0,y:0},lastSinglePos:{x:t.clientX,y:t.clientY}};let i;n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY});const r=t=>{if(n.pointers.has(t.pointerId))if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),n.pointers.size>=2){const o=Array.from(n.pointers.values()),i=Math.hypot(o[0].x-o[1].x,o[0].y-o[1].y),r={x:(o[0].x+o[1].x)/2,y:(o[0].y+o[1].y)/2},s=n.lastDis>0?i/n.lastDis:1,a=r.x-n.lastPos.x,c=r.y-n.lastPos.y;e(t,s,{x:a,y:c}),n.lastDis=i,n.lastPos=r}else{const o=t.clientX-n.lastSinglePos.x,i=t.clientY-n.lastSinglePos.y;0===o&&0===i||(e(t,1,{x:o,y:i}),n.lastSinglePos={x:t.clientX,y:t.clientY})}else if(n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},s=t=>{if(n.pointers.delete(t.pointerId),1===n.pointers.size){n.lastDis=0;const t=Array.from(n.pointers.values());n.lastSinglePos={x:t[0].x,y:t[0].y}}0===n.pointers.size&&(window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",s),window.removeEventListener("pointerdown",i))};i=t=>{if(o.setPointerCapture?.(t.pointerId),n.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY}),2===n.pointers.size){const t=Array.from(n.pointers.values());n.lastDis=Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y),n.lastPos={x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}},o.setPointerCapture?.(t.pointerId),window.addEventListener("pointermove",r,{passive:!1}),window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s),window.addEventListener("pointerdown",i)},t.scaleWheel=function(t,e){if(!t.deltaY)return;const o=Math.abs(t.deltaY),n=o*(o>50?.0015:.003);e(t,t.deltaY<0?1+n:1-n,{x:0,y:0})},t.setCursor=r,t.setDragData=function(t){p=t}});
